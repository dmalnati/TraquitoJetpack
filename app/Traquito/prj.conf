#####################################################################
# set up project to use c++17 and useful libs/stl
#####################################################################
CONFIG_CPP=y
CONFIG_REQUIRES_FULL_LIBCPP=y
CONFIG_CPP_MAIN=y
CONFIG_STD_CPP20=y
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y
CONFIG_CBPRINTF_FP_SUPPORT=y


#####################################################################
# maximum debugging - my code, kernel, everything
#####################################################################
CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_DEBUG=y
CONFIG_DEBUG_THREAD_INFO=y
CONFIG_EXCEPTION_STACK_TRACE=y
CONFIG_DEBUG_INFO=y


#####################################################################
# Power Management
#####################################################################


# enabled by default but let's be explicit
# CONFIG_PM=y

# collect stats for this module
# CONFIG_PM_STATS=y

# enable using device driver hooks to be called when
# going in to or out of suspend
# CONFIG_PM_DEVICE=y
# allow individual devices to be suspended/resumed regardless
# of the rest of the system state
# CONFIG_PM_DEVICE_RUNTIME=y
# use the preferred method of managing power, it is handled
# continuously by components close to the resources and
# who are power aware.  resources are meant to be kept
# in the lowest appropriate power state such that
# when a pm_system_suspend() is invoked, it is performed
# more quickly
# CONFIG_PM_DEVICE_RUNTIME_EXCLUSIVE=n



# Allow custom hooks to decide policy each idle period (PowerManager)
# Uncommenting this, and the CMakeLists including Power Manager gets
# the tests going again, but moving on for now.
# CONFIG_PM_POLICY_CUSTOM=y



#####################################################################
# PICO specific HWINFO
#####################################################################

# https://github.com/zephyrproject-rtos/zephyr/pull/54290
# https://github.com/zephyrproject-rtos/zephyr/commit/480ff022bde2d450372bf5339f5ed06453ff9176

# seemingly not ready yet, so commenting out for now

# CONFIG_RP2_BINARY_INFO=y

# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_NAME_OVERRIDE=y
# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_NAME="Traquito"

# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_DESCRIPTION_OVERRIDE=y
# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_DESCRIPTION="Traquito"

# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_URL_OVERRIDE=y
# CONFIG_RP2_BINARY_INFO_RP_PROGRAM_URL="https://traquito.github.io"


#####################################################################
# PICO features
#####################################################################

CONFIG_RPI_PICO_TEMP=y


#####################################################################
# kernel features
#####################################################################

# kernel pipes
CONFIG_PIPES=y


#####################################################################
# main thread
#####################################################################

CONFIG_MAIN_STACK_SIZE=4096


#####################################################################
# system features
#####################################################################

# Enable rebooting by code
CONFIG_REBOOT=y

# monitor high-water mark on stack by placing known-values in stack
# buffer before running
CONFIG_INIT_STACKS=y

# support random number generation
CONFIG_ENTROPY_GENERATOR=y

# Support checking the temperature
CONFIG_SENSOR=y

# Enable I2C/TWI
# https://docs.zephyrproject.org/latest/hardware/peripherals/i2c.html
CONFIG_I2C=y


# watchdog control
CONFIG_WATCHDOG=y
CONFIG_WDT_DISABLE_AT_BOOT=y


# enable access to flash storage
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_NVS=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y


# ADC
CONFIG_ADC=y

# enable stats collection per-module
CONFIG_STATS=y


CONFIG_HWINFO=y

#####################################################################
# Set up interfacing
#####################################################################

# no startup banner
CONFIG_BOOT_BANNER=n

# I want serial enabled in general
CONFIG_SERIAL=y
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_UART_LINE_CTRL=y

# I want logging to function
CONFIG_LOG=y

# I want to use the serial interface for logging
# but when I enable shell, this makes printf'd material come out twice,
# once normally, and another time with the shell prefix.
# so I'm disabling it for now.
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_BACKEND_SWO=n

# I want synchronous logging (no queue and print later)
CONFIG_LOG_MODE_IMMEDIATE=y

# I want to be able to influnce what gets logged at runtime (via shell)
CONFIG_LOG_RUNTIME_FILTERING=y

# I want the default to be that every module prints all levels
# 0 = off
# 1 = error
# 2 = error and warning
# 3 = error and warning and info
# 4 = error and warning and info and debug
CONFIG_LOG_DEFAULT_LEVEL=3

# show function name in output
CONFIG_LOG_FUNC_NAME_PREFIX_ERR=y
CONFIG_LOG_FUNC_NAME_PREFIX_WRN=y
CONFIG_LOG_FUNC_NAME_PREFIX_INF=y
CONFIG_LOG_FUNC_NAME_PREFIX_DBG=y

# color it
CONFIG_LOG_BACKEND_SHOW_COLOR=y

# redirect printk to the log
# I am disabling this, because when shell enabled, prink output was
# prefixed with shell.  now I see it on serial with no prefix.
#CONFIG_LOG_PRINTK=y



# ##### Shell #####

# # I want the shell interface to operate
CONFIG_SHELL=y




#####################################################################
# set up stats
#####################################################################
CONFIG_THREAD_RUNTIME_STATS=y




#####################################################################
# set up pwm
#####################################################################
CONFIG_PWM=y


#####################################################################
# set up usb
#####################################################################

CONFIG_USB_DEVICE_DRIVER=y
CONFIG_USB_DEVICE_STACK=y

#
# USB Device Identification
#
CONFIG_USB_DEVICE_SN="0123456789ABCDEF"
CONFIG_USB_DEVICE_VID=0x2FE3
CONFIG_USB_DEVICE_PID=0x0008
CONFIG_USB_DEVICE_MANUFACTURER="Traquito"
CONFIG_USB_DEVICE_PRODUCT="Traquito"

#
# Serial via USB
#
CONFIG_USB_CDC_ACM=y
# makes windows 7 work
CONFIG_CDC_ACM_IAD=y

# use this instead?  NRFX was 2048, this defaults to 1024
# CONFIG_USB_WORKQUEUE_STACK_SIZE=








# CONFIG_USB_MASS_STORAGE=y
# # must be 8 chars
# CONFIG_MASS_STORAGE_INQ_VENDOR_ID="ABCDEFGH"
# # must be 16 chars
# CONFIG_MASS_STORAGE_INQ_PRODUCT_ID="0123456789ABCDEF"
# CONFIG_MASS_STORAGE_STACK_SIZE=2048


# CONFIG_DISK_DRIVER_RAM=y
# CONFIG_FILE_SYSTEM=y
# CONFIG_FAT_FILESYSTEM_ELM=y
# CONFIG_DISK_RAM_VOLUME_SIZE=2



# CONFIG_DISK_ACCESS=y
# CONFIG_DISK_DRIVERS=y
# CONFIG_FS_FATFS_READ_ONLY=n
# CONFIG_FS_FATFS_MOUNT_MKFS=y

# CONFIG_NRF_APPROTECT_LOCK=
# CONFIG_NRF_APPROTECT_USE_UICR=
# CONFIG_NRF_APPROTECT_USER_HANDLING=


#####################################################################
# set up disk
#####################################################################

# CONFIG_DISK_ACCESS=y
# CONFIG_DISK_DRIVERS=y


# CONFIG_FLASH=y
# CONFIG_DISK_DRIVER_FLASH=y


# CONFIG_FLASH_MAP=y
# CONFIG_FLASH_PAGE_LAYOUT=y
# CONFIG_MPU_ALLOW_FLASH_WRITE=y


# CONFIG_FILE_SYSTEM=y
# CONFIG_FAT_FILESYSTEM_ELM=y
# CONFIG_FS_FATFS_READ_ONLY=n
# CONFIG_FS_FATFS_MOUNT_MKFS=y




# #####################################################################
# # set multi-protocol service layer (multiple radio protocol support)
# #####################################################################
# # enable multi-protocol service layer (doesn't work with CONFIG_BT_LL_SW_SPLIT seemingly)
# CONFIG_MPSL=y
# # max sessions MPSL will support
# # 1 for BLE
# # 1 for ESB
# # 2 for MPSL shell testing
# # 1 for ESB shell testing
# CONFIG_MPSL_TIMESLOT_SESSION_COUNT=5
# # let's see during dev
# CONFIG_MPSL_LOG_LEVEL_DBG=y
# # allow myself to catch assert errors in my own code (and still die)
# CONFIG_MPSL_ASSERT_HANDLER=y






#####################################################################
# set up ble
#####################################################################
# CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
# CONFIG_BT_RX_STACK_SIZE=4096
# CONFIG_MAIN_STACK_SIZE=6114
# CONFIG_BT=y
# CONFIG_BT_HCI=y
# CONFIG_BT_CTLR=y
# # Use the zephyr BLE implementation instead of the SoftDevice from Nordic
# # CONFIG_BT_LL_SW_SPLIT=y


# # use extended advertising
# CONFIG_BT_EXT_ADV=y
# # support this many advertising sets
# CONFIG_BT_EXT_ADV_MAX_ADV_SET=4


# CONFIG_BT_PERIPHERAL=y
# CONFIG_BT_CENTRAL=y
# CONFIG_BT_BROADCASTER=y
# CONFIG_BT_OBSERVER=y

# # Enable Security Manager Protocol (SMP), making it possible to pair devices over LE
# CONFIG_BT_SMP=y

# # allow me to set the code to show to users on their device via bt_passkey_set()
# CONFIG_BT_FIXED_PASSKEY=y

# # let me see more details about the other side of the connection
# CONFIG_BT_REMOTE_INFO=y

# # let me change and see changes to the PHY layer
# CONFIG_BT_USER_PHY_UPDATE=y

# # let me change and see changes to the data length (MTU?)
# CONFIG_BT_USER_DATA_LEN_UPDATE=y

# # let me express preferences for phy modulation
# CONFIG_BT_CTLR_PHY_CODED=y
# # CONFIG_BT_HCI_VS_EXT=y
# # CONFIG_BT_PHY_UPDATE=y

# # let me change (my) and measure (their) transmit power levels
# CONFIG_BT_CTLR_CONN_RSSI=y
# # CONFIG_BT_CTLR_ADVANCED_FEATURES=y    ; # triggers warning, needed?
# CONFIG_BT_CTLR_TX_PWR_DYNAMIC_CONTROL=y
# # ?
# # CONFIG_BT_TPS=y



# #####################################################################
# # set up ESB (extended shock burst)
# #####################################################################
# CONFIG_ESB=y
# CONFIG_NCS_SAMPLES_DEFAULTS=y
# CONFIG_ESB_MAX_PAYLOAD_LENGTH=252
# CONFIG_ESB_RX_FIFO_SIZE=1
# CONFIG_ESB_TX_FIFO_SIZE=1



# fat frames
# https://devzone.nordicsemi.com/f/nordic-q-a/84226/increasing-ble-mtu-data-length-for-notifications-on-ncs-v1-8
# https://github.com/zephyrproject-rtos/zephyr/issues/25648
# Uncoded LE Data Packet Format:
#
# | Preamble | Access  |                           PDU (2 to 257 bytes)                         |   CRC   |
# |          | Address | LL Header |       Link Layer PDU (0 to 251 bytes)           |    MIC   |         |
# |          |         |           | L2CAP Header |      L2CAP PDU (0-247 bytes)     | Optional |         |
# |          |         |           |              |    ATT Header    |  ATT Payload  |          |         |
# |          |         |           |              | OpCode | Handle  |               |          |         |
# |  1 byte  | 4 bytes |  2 bytes  |   4 bytes    | 1 byte | 2 bytes | 0 - 244 bytes | 4 bytes  | 3 bytes |
#
# L2CAP can be larger than 247 bytes, but will be split across multiple LL packets as a result.
# ATT payloads can be larger than 244 bytes, but will be split across multiple LL packets as a result.
# 
#
# Kconfig Symbols:
#     CONFIG_BT_CTLR_DATA_LENGTH_MAX : Maximum payload size of the Link Layer PDU
#     CONFIG_BT_BUF_ACL_TX_SIZE      : Maximum L2CAP PDU is limited to this value - 4
#     CONFIG_BT_BUF_ACL_RX_SIZE      : Maximum L2CAP PDU is limited to this value - 4
#     CONFIG_BT_L2CAP_TX_MTU         : Maximum L2CAP PDU size for transmission
# CONFIG_BT_BUF_ACL_RX_SIZE=251
# CONFIG_BT_BUF_ACL_TX_SIZE=251
# CONFIG_BT_L2CAP_TX_MTU=247
# CONFIG_BT_CTLR_DATA_LENGTH_MAX=251
# # CONFIG_BT_GATT_AUTO_UPDATE_MTU=


# CONFIG_BT_GATT_DYNAMIC_DB=y
# CONFIG_BT_DEVICE_APPEARANCE_DYNAMIC=y
# CONFIG_BT_DEVICE_NAME_DYNAMIC=y


# # unsure these
# #CONFIG_BT_EXT_ADV=y


# # settings subsystem required as well for bluetooth libs (for bonding)
# CONFIG_BT_SETTINGS=y
# CONFIG_FLASH=y
# CONFIG_FLASH_PAGE_LAYOUT=y
# CONFIG_FLASH_MAP=y
# CONFIG_NVS=y
# CONFIG_SETTINGS=y

# # major memory hog, ~2k per connection (wtf)
# CONFIG_BT_MAX_CONN=20


#####################################################################
# allow access to flash for read/write (non-volatile memory store)
#####################################################################

# CONFIG_MPU_ALLOW_FLASH_WRITE=y

# CONFIG_FLASH=y
# CONFIG_FLASH_MAP=y
# CONFIG_FLASH_PAGE_LAYOUT=y

# CONFIG_FILE_SYSTEM=y
# CONFIG_FILE_SYSTEM_LITTLEFS=y





